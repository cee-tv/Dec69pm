<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Video Player</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.4.2/shaka-player.compiled.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');
  </style>
</head>
<body>
  <div class="min-h-screen max-w-[100vw] overflow-x-hidden">
    <div id="container" class="w-full h-[100vh] max-w-[600px] mx-auto flex flex-col items-center justify-center bg-[#121212] relative">
      <div class="absolute top-0 left-0 w-full p-4 md:p-6 flex justify-between items-center bg-gradient-to-b from-black/80 to-transparent z-10">
        <button id="channelListBtn" class="text-white hover:text-gray-300 p-2 rounded-full bg-black/30">
          <i class="fas fa-list text-xl md:text-2xl"></i>
        </button>
        <h1 id="channelName" class="text-white font-bold text-lg md:text-xl font-roboto">TV 5</h1>
        <button id="fullscreenBtn" class="text-white hover:text-gray-300 p-2 rounded-full bg-black/30">
          <i class="fas fa-expand text-xl md:text-2xl"></i>
        </button>
      </div>

      <video id="video" class="w-full h-full object-contain" autoplay playsinline></video>

      <div id="bufferingIndicator" class="absolute inset-0 flex items-center justify-center bg-black/40 hidden">
        <div class="animate-spin rounded-full h-12 w-12 md:h-16 md:w-16 border-4 border-white border-t-transparent"></div>
      </div>

      <div class="absolute bottom-0 left-0 w-full p-4 md:p-8 bg-gradient-to-t from-black/80 to-transparent z-10">
        <div class="flex justify-center items-center gap-6 md:gap-12">
          <button id="prevBtn" class="text-white hover:text-gray-300 p-3 rounded-full bg-black/30">
            <i class="fas fa-backward text-xl md:text-2xl"></i>
          </button>
          <button id="playPauseBtn" class="text-white hover:text-gray-300 p-4 rounded-full bg-black/30">
            <i class="fas fa-pause text-2xl md:text-3xl"></i>
          </button>
          <button id="nextBtn" class="text-white hover:text-gray-300 p-3 rounded-full bg-black/30">
            <i class="fas fa-forward text-xl md:text-2xl"></i>
          </button>
        </div>
      </div>

      <div id="channelList" class="absolute left-0 top-16 md:left-4 md:top-20 w-[90%] mx-auto md:w-72 bg-[#1a1a1a] rounded-lg shadow-xl p-4 border border-gray-800 hidden">
        <input 
          type="text" 
          id="searchInput"
          placeholder="Search channels..." 
          class="w-full mb-4 px-4 py-3 bg-[#2a2a2a] text-white rounded-lg border border-gray-700 focus:outline-none focus:border-white/50"
         />
        <ul id="channelsList" class="space-y-2 max-h-[60vh] overflow-y-auto"></ul>
      </div>
    </div>
  </div>

  <script>
    const channels = [
      {
        name: "TV 5",
        url: "https://qp-pldt-live-grp-02-prod.akamaized.net/out/u/tv5_hd.mpd",
        keyId: "2615129ef2c846a9bbd43a641c7303ef",
        key: "07c7f996b1734ea288641a68e1cfdc4d",
      },
      {
        name: "GMA", 
        url: "https://cdn-uw2-prod.tsv2.amagi.tv/linear/amg01006-abs-cbn-abscbn-gma-x7-dash-abscbnono/7c693236-e0c1-40a3-8bd0-bb25e43f5bfc/index.mpd",
        keyId: "c95ed4c44b0b4f7fa1c6ebbbbaab21a1", 
        key: "47635b8e885e19f2ccbdff078c207058",
      }
    ];

    let player = null;
    let currentChannel = 0;
    const video = document.getElementById('video');
    const container = document.getElementById('container');
    const channelList = document.getElementById('channelList');
    const searchInput = document.getElementById('searchInput');
    const channelsListEl = document.getElementById('channelsList');
    const bufferingIndicator = document.getElementById('bufferingIndicator');
    const channelNameEl = document.getElementById('channelName');

    async function initPlayer() {
      shaka.polyfill.installAll();

      if (!shaka.Player.isBrowserSupported()) {
        console.error("Browser not supported");
        return;
      }

      try {
        if(player) {
          await player.destroy();
        }

        player = new shaka.Player(video);
        const channel = channels[currentChannel];

        player.configure({
          drm: {
            clearKeys: {
              [channel.keyId]: channel.key
            }
          },
          abr: {
            enabled: true,
            restrictions: {
              maxHeight: 1080
            }
          },
          streaming: {
            rebufferingGoal: 2,
            bufferingGoal: 10,
            bufferBehind: 30
          }
        });

        await player.load(channel.url);
        channelNameEl.textContent = channel.name;
        
        video.play().catch(error => {
          console.error("Autoplay failed:", error);
        });

      } catch (error) {
        console.error("Error loading player:", error);
      }
    }

    document.getElementById('channelListBtn').onclick = () => {
      channelList.classList.toggle('hidden');
      renderChannelList();
    };

    document.getElementById('playPauseBtn').onclick = () => {
      if(video.paused) {
        video.play();
        document.querySelector('#playPauseBtn i').classList.replace('fa-play', 'fa-pause');
      } else {
        video.pause();
        document.querySelector('#playPauseBtn i').classList.replace('fa-pause', 'fa-play');
      }
    };

    document.getElementById('fullscreenBtn').onclick = () => {
      if(!document.fullscreenElement) {
        container.requestFullscreen();
        document.querySelector('#fullscreenBtn i').classList.replace('fa-expand', 'fa-compress');
      } else {
        document.exitFullscreen();
        document.querySelector('#fullscreenBtn i').classList.replace('fa-compress', 'fa-expand');
      }
    };

    document.getElementById('nextBtn').onclick = async () => {
      currentChannel = (currentChannel + 1) % channels.length;
      await initPlayer();
    };

    document.getElementById('prevBtn').onclick = async () => {
      currentChannel = (currentChannel - 1 + channels.length) % channels.length;
      await initPlayer();
    };

    function renderChannelList() {
      const searchQuery = searchInput.value.toLowerCase();
      const filteredChannels = channels.filter(channel => 
        channel.name.toLowerCase().includes(searchQuery)
      );

      channelsListEl.innerHTML = filteredChannels.map((channel, index) => `
        <li>
          <button 
            onclick="selectChannel(${index})"
            class="w-full text-left px-4 py-3 rounded-lg text-white transition-colors ${
              currentChannel === index ? 'bg-white/20' : 'hover:bg-white/10'
            }"
          >
            ${channel.name}
          </button>
        </li>
      `).join('');
    }

    async function selectChannel(index) {
      currentChannel = index;
      channelList.classList.add('hidden');
      await initPlayer();
    }

    searchInput.addEventListener('input', renderChannelList);

    video.addEventListener('waiting', () => bufferingIndicator.classList.remove('hidden'));
    video.addEventListener('playing', () => bufferingIndicator.classList.add('hidden'));

    document.addEventListener('fullscreenchange', () => {
      const icon = document.querySelector('#fullscreenBtn i');
      if(document.fullscreenElement) {
        icon.classList.replace('fa-expand', 'fa-compress');
      } else {
        icon.classList.replace('fa-compress', 'fa-expand');
      }
    });

    initPlayer();
  </script>
</body>
</html>

